package iart;

import java.awt.Toolkit;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Enumeration;
import javax.swing.DefaultListModel;
import javax.swing.JFileChooser;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.filechooser.FileNameExtensionFilter;

public class GUIMain extends javax.swing.JFrame {

   private final DefaultListModel<String> defaultListModel = new DefaultListModel<>();

    public GUIMain() {
        initComponents();
    }

    private final int EXAMPLES_TAB = 0;
    private final int HISTORY_TAB = 1;
    private final int OUTPUT_TAB = 2;

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jToolBar1 = new javax.swing.JToolBar();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jButton6 = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();
        jSplitPane1 = new javax.swing.JSplitPane();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jButton4 = new javax.swing.JButton();
        tbPanel = new javax.swing.JTabbedPane();
        jScrollPane5 = new javax.swing.JScrollPane();
        jList2 = new javax.swing.JList();
        jScrollPane3 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTextArea2 = new javax.swing.JTextArea();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTextPane1 = new javax.swing.JTextPane();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Bibliogenie");
        setIconImage(Toolkit.getDefaultToolkit().getImage(getClass().getResource("/iart/resources/application.png")));

        jToolBar1.setBorder(javax.swing.BorderFactory.createEmptyBorder(4, 4, 0, 4));
        jToolBar1.setFloatable(false);
        jToolBar1.setRollover(true);
        jToolBar1.setAlignmentY(0.5F);

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/iart/resources/application_xp_terminal.png"))); // NOI18N
        jButton1.setText("Carregar");
        jButton1.setFocusable(false);
        jButton1.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton1.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton1);

        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/iart/resources/disk.png"))); // NOI18N
        jButton2.setText("Guardar");
        jButton2.setFocusable(false);
        jButton2.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton2.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton2);

        jButton6.setIcon(new javax.swing.ImageIcon(getClass().getResource("/iart/resources/arrow_down.png"))); // NOI18N
        jButton6.setText("Executar");
        jButton6.setFocusable(false);
        jButton6.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton6.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton6ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton6);

        jButton3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/iart/resources/delete.png"))); // NOI18N
        jButton3.setText("Limpar");
        jButton3.setFocusable(false);
        jButton3.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton3.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton3);

        jButton5.setIcon(new javax.swing.ImageIcon(getClass().getResource("/iart/resources/door_in.png"))); // NOI18N
        jButton5.setText("Sair");
        jButton5.setFocusable(false);
        jButton5.setHorizontalTextPosition(javax.swing.SwingConstants.RIGHT);
        jButton5.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });
        jToolBar1.add(jButton5);

        getContentPane().add(jToolBar1, java.awt.BorderLayout.PAGE_START);

        jSplitPane1.setBorder(null);
        jSplitPane1.setDividerSize(0);
        jSplitPane1.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);

        jPanel1.setLayout(new java.awt.GridBagLayout());

        jLabel1.setText("Faça uma pergunta:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.insets = new java.awt.Insets(8, 8, 8, 8);
        jPanel1.add(jLabel1, gridBagConstraints);

        jTextField1.setMinimumSize(new java.awt.Dimension(80, 20));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(8, 0, 8, 0);
        jPanel1.add(jTextField1, gridBagConstraints);

        jButton4.setText("Pesquisar");
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.insets = new java.awt.Insets(8, 8, 8, 8);
        jPanel1.add(jButton4, gridBagConstraints);

        jSplitPane1.setLeftComponent(jPanel1);

        tbPanel.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 4, 4, 4));

        jList2.setModel(new javax.swing.AbstractListModel() {
            String[] strings = { "Quem escreveu Os Maias?", "Quais são os livros mais conhecidos de Fernando Pessoa?", "Quem são os escritores africanos?", "E portugueses?", "Quais os escritores portugueses e espanhóis do século XV?", "Quantos livros de escritores africanos existem após o século XVI?", "E qual é o mais recente?", "Alberto Caeiro é heterónimo de Fernando Pessoa." };
            public int getSize() { return strings.length; }
            public Object getElementAt(int i) { return strings[i]; }
        });
        jList2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jList2MouseClicked(evt);
            }
        });
        jList2.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jList2ValueChanged(evt);
            }
        });
        jScrollPane5.setViewportView(jList2);

        tbPanel.addTab("Exemplos", jScrollPane5);

        jList1.setModel(defaultListModel);
        jList1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jList1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jList1MouseClicked(evt);
            }
        });
        jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                jList1ValueChanged(evt);
            }
        });
        jScrollPane3.setViewportView(jList1);

        tbPanel.addTab("Histórico", jScrollPane3);

        jTextArea2.setEditable(false);
        jTextArea2.setColumns(40);
        jTextArea2.setFont(jTextArea2.getFont());
        jTextArea2.setLineWrap(true);
        jTextArea2.setRows(8);
        jTextArea2.setTabSize(4);
        jScrollPane2.setViewportView(jTextArea2);

        tbPanel.addTab("Output", jScrollPane2);

        jTextPane1.setEditable(false);
        jTextPane1.setContentType("text/html"); // NOI18N
        jTextPane1.setText("<html>\n  <head>\n\n<style>\nhtml, body {\nmargin:0;\npadding:0;\n}\n</style>\n  </head>\n  <body>\n      \n<h2 syle=\"margin-top:0;text-align:center;\">Bibliogenie!</h2>\n<b>Autores:</b>\n<p style=\"margin-top:0\">&nbsp;&nbsp;&nbsp;&nbsp;Diogo Marques (<a href=\"mailto:up201305642@fe.up.pt\">up201305642@fe.up.pt</a>)</p>\n\t<p style=\"margin-top:0\">&nbsp;&nbsp;&nbsp;&nbsp;Pedro Melo (up201305618.fe.up.pt)</p>\n<b style=\"margin-bottom:0\">Instruções:</b>\n\t<ul style=\"margin-left:16px\">\n\t<li><b>Read:</b> carrega uma lista de perguntas de um ficheiro de texto</li>\n\t<li><b>Save: </b> guarda histórico de perguntas num ficheiro de texto</li>\n\t<li><b>Execute:</b> executa todas as perguntas existentes no histórico</li>\n\t<li><b>Clear:</b> limpa todo o histórico das perguntas (se o utilizador estiver na tab \"History\"), limpa a consola de output (se o utilizador estiver na tab \"Output\"</li>\n\t<li><b>Exit:</b>abandona este programa sem confirmação</li>\n\t</ul>\n<b><i>Descrição</i></b>\n<p style=\"margin: 0 0 12px; text-align: justify;\">\nO programa deve interpretar e responder a frases&nbsp;escritas em linguagem natural, <span style=\"font-weight: bold;\">usando DCGs</span>.&nbsp;</span><span lang=\"PT\">O programa deve incluir informação sobre </span>escritores e respetivas obras literárias<span lang=\"PT\"><span lang=\"pt\"></span> (pode\nincluir outra informação que considere relevante).\n</p>\n<p style=\"margin: 0pt 0cm 12px; text-align: justify;\">O programa deve respeitar os seguintes <span style=\"text-decoration: underline;\">requisitos</span>:</p>\n<ul style=\"margin-left:16px\">\n<li>Aceitação de frases afirmativas</li>\n<li>Aceitação de frases interrogativas</li>\n<li>Verificação da sintaxe da frase</li>\n<li>Verificação da semântica da frase</li>\n<li>Inclusão de um ou mais comandos. A inclusão de mais que um comando numa mesma frase é traduzida pelo uso da partícula \"e\" nessa frase</li>\n<li>Aceitação de frases iniciadas pela partícula \"e\", devendo ser guardado o contexto da frase anterior para resposta a esta frase</li>\n<li>Uso de adjetivos e complementos (proposicionais, de modo, ...)</span></li>\n</ul>\n</body>\n</html>");
        jTextPane1.setHighlighter(null);
        jTextPane1.setKeymap(null);
        jScrollPane4.setViewportView(jTextPane1);

        tbPanel.addTab("Informações", jScrollPane4);

        jSplitPane1.setBottomComponent(tbPanel);

        getContentPane().add(jSplitPane1, java.awt.BorderLayout.CENTER);

        setSize(new java.awt.Dimension(450, 339));
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        search(jTextField1.getText()); 
    }//GEN-LAST:event_jButton4ActionPerformed

    private void search(String queryMessage) {
       
        jList1.clearSelection();
        jList2.clearSelection();
        
        if (queryMessage == null || queryMessage.isEmpty()) {
            return;
        }
      
        if (defaultListModel.contains(queryMessage)) {
            defaultListModel.removeElement(queryMessage);          
        }
      
        defaultListModel.addElement(queryMessage);
        tbPanel.setSelectedIndex(OUTPUT_TAB);
        jTextField1.setText(queryMessage);
        query(queryMessage);
    }
   
    private void jList1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList1MouseClicked
       searchList(evt);
    }//GEN-LAST:event_jList1MouseClicked

    private void query(String queryMessage) {
        jTextArea2.append("\n" + "Q: " + queryMessage + "\nA: NOT IMPLEMENTED\n");
    }
    
    private void searchList(java.awt.event.MouseEvent evt)
    {
        final JList list = (JList) evt.getSource();
        
        if (evt.getClickCount() == 2) {
            
            final String selectedValue = (String) list.getSelectedValue();    
            
            if (selectedValue != null) {
                search(selectedValue);
            }
        }
    }
    
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
       
        JFileChooser fileChooser = new JFileChooser();
        fileChooser.setFileFilter(new FileNameExtensionFilter("Ficheiros de texto (*.txt)", "txt"));
        
        if (fileChooser.showOpenDialog(this) != JFileChooser.APPROVE_OPTION) {
            return;
        }
        
        try (BufferedReader br = new BufferedReader(new FileReader(fileChooser.getSelectedFile()))) {
            defaultListModel.clear();
            tbPanel.setSelectedIndex(HISTORY_TAB);
        
            for (String line; (line = br.readLine()) != null;) {
                defaultListModel.addElement(line);
            }
        }
        catch (IOException ex) {
            JOptionPane.showMessageDialog(this, ex.getLocalizedMessage(), "Bibliogenie", JOptionPane.ERROR_MESSAGE);
        }  
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
       
        JFileChooser fileChooser = new JFileChooser();
        fileChooser.setFileFilter(new FileNameExtensionFilter("Ficheiros de texto (*.txt)", "txt"));

        if (fileChooser.showSaveDialog(this) != JFileChooser.APPROVE_OPTION) {
            return;
        }

        File buffer = new File(fileChooser.getSelectedFile() + ".txt");

        try (BufferedWriter oout = new BufferedWriter(new FileWriter(buffer))) {
        
            for (int i = 0; i < defaultListModel.getSize(); i++) {
            
                oout.write((String) defaultListModel.elementAt(i));
                
                if (i < defaultListModel.getSize() - 1) {
                    oout.newLine();
                }
            }
        }
        catch (IOException ex) {
            JOptionPane.showMessageDialog(this, ex.getLocalizedMessage(), "Bibliogenie", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        
        jTextField1.setText("");
        
        switch (tbPanel.getSelectedIndex()) {
           case HISTORY_TAB:
               defaultListModel.clear();
               break;
           case OUTPUT_TAB:
               jTextArea2.setText("");
               break;
           case EXAMPLES_TAB:
               jList2.clearSelection();         
               break;
       }
    }//GEN-LAST:event_jButton3ActionPerformed

    private void jButton6ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton6ActionPerformed
        
        final Enumeration<String> s = defaultListModel.elements();
        
        while (s.hasMoreElements()) {
            query(s.nextElement());
        }
        
        tbPanel.setSelectedIndex(OUTPUT_TAB);
    }//GEN-LAST:event_jButton6ActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        System.exit(0);
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jList2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList2MouseClicked
        searchList(evt);
    }//GEN-LAST:event_jList2MouseClicked

    private void jList2ValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_jList2ValueChanged
        jTextField1.setText(((String)jList2.getSelectedValue()));
    }//GEN-LAST:event_jList2ValueChanged

    private void jList1ValueChanged(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_jList1ValueChanged
        jTextField1.setText((String)jList1.getSelectedValue());
    }//GEN-LAST:event_jList1ValueChanged

    public static void main(String args[]) {
    	try {
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | UnsupportedLookAndFeelException ex) {
            JOptionPane.showMessageDialog(null, ex.getLocalizedMessage(), "Bibliogenie", JOptionPane.ERROR_MESSAGE);
        }
        
        //</editor-fold>
        java.awt.EventQueue.invokeLater(() -> {
            new GUIMain().setVisible(true);
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JList jList1;
    private javax.swing.JList jList2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JTextArea jTextArea2;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextPane jTextPane1;
    private javax.swing.JToolBar jToolBar1;
    private javax.swing.JTabbedPane tbPanel;
    // End of variables declaration//GEN-END:variables
}